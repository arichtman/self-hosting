  secure-email:
    container_name: protonmail-bridge
    hostname: mail.${TOP_LEVEL_DOMAIN}
    image: ${PROTONMAIL_BRIDGE_IMAGE}
    restart: unless-stopped
    expose:
      - ${PROTONMAIL_BRIDGE_SMTP_PORT}
      - ${PROTONMAIL_BRIDGE_IMAP_PORT}
    # ports:
    #   - "25:25"
    #   - "143:143"
    networks:
      - web
    # network_mode: host
    environment:
      BRIDGE_EXTRA_ARGS: ${PROTONMAIL_BRIDGE_EXTRA_ARGS}
      PROTONMAIL_LOGIN: ${PROTONMAIL_BRIDGE_USER}
      PROTONMAIL_PASSWORD: ${PROTONMAIL_BRIDGE_PASSWORD}
      PROTONMAIL_EXTRA_2FA: ${PROTONMAIL_BRIDGE_EXTRA_2FA}
      SMTP_PORT: ${PROTONMAIL_BRIDGE_SMTP_PORT}
      IMAP_PORT: ${PROTONMAIL_BRIDGE_IMAP_PORT}
    volumes:
      - ${BASE_DATA_LOCATION}/protonmail:/root
    labels:
      - "traefik.enable=true"
      - "traefik.tcp.routers.secure-email.rule=HostSNI(`*`)"
      - "traefik.tcp.routers.secure-email.entrypoints=smtp"
      - "traefik.tcp.routers.secure-email.service=secure-email"
      # - "traefik.tcp.routers.secure-email.tls.passthrough=true"
      - "traefik.tcp.services.secure-email.loadbalancer.server.port=${PROTONMAIL_BRIDGE_SMTP_PORT}"
    depends_on:
      - reverse-proxy
